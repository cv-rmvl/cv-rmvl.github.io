<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta name="generator" content="Doxygen 1.13.2" />
  <title>RMVL: 参数模块使用教程</title>
  <link href="../../rmvl-logo-small.png" rel="shortcut icon" type="image/x-icon" />
  <link href="../../tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="../../jquery.js"></script>
  <script type="text/javascript" src="../../dynsections.js"></script>
  <script type="text/javascript" src="../../tutorial-utils.js"></script>
  <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
  <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
  <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
  <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
  <!-- ... other metadata & script includes ... -->
  <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
  </script>
  <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
  </script>
  <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeInteractiveToc.init()
  </script>
  <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeParagraphLink.init()
  </script>
</head>
<body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
      <!--#include virtual="/google-search.html"-->
      <script type="text/javascript" src="/docs/version.js"></script>
      <table cellspacing="0" cellpadding="0">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectlogo"><img alt="Logo" src="../../rmvl-logo.png" /></td>
            <td style="padding-left: 0.5em;">
              <div id="projectname">RMVL
                &#160;<span id="projectnumber">2.2.0</span>
              </div>
              <div id="projectbrief">Robotic Manipulation and Vision Library</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','搜索',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dd/da0/tutorials.html">RMVL 使用教程</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">参数模块使用教程</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1 empty">
    <ul>
      <li class="level2">
        <a href="#autotoc_md293">1. 参数模块简介</a>
      </li>
      <li class="level2">
        <a href="#autotoc_md294">2. 参数规范文件</a>
      </li>
      <li class="level2">
        <a href="#autotoc_md295">3. C++ 代码生成</a>
        <ul>
          <li class="level3">
            <a href="#autotoc_md296">3.1 rmvl_generate_para</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md297">3.2 rmvl_generate_module_para</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#autotoc_md298">4. 运行时加载</a>
        <ul>
          <li class="level3">
            <a href="#autotoc_md299">4.1 加载方式</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md300">4.2 YAML 文件格式</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__2home_2zhaoxi_2_xE6_xA1_x8C_xE9_x9D_xA2_2Vision_2cv-rmvl_2rmvl_2doc_2tutorials_2modules_2tutorial__rmvlpara"></a></p>
<p><b>上一篇教程：</b><a class="el" href="../../d6/d6e/tutorial_table_of_content_modules.html">主要模块使用教程</a> ↑<br  />
 <b>下一篇教程：</b><a class="el" href="../../d6/d3f/tutorial_table_of_content_extra.html">扩展模块使用教程</a> ↓<br  />
</p>
<hr  />
<h2><a class="anchor" id="autotoc_md293"></a>
1. 参数模块简介</h2>
<p>RMVL 中，一部分模块（涉及主要模块和扩展模块）的功能在不同运行环境或者不同需求的情况下需要有不同的参数配置，为此 RVML 将这些运行时可变的参数提炼出来，并且使用统一的管理方式，完成了参数类型、参数默认值、参数名、参数运行时加载的定义。</p>
<p>原先若有计划使用运行时参数，在</p>
<ul>
<li>调整参数名、参数默认值</li>
<li>新增某一参数类（结构体）</li>
</ul>
<p>的时候，需要在头文件以及对应源文件的位置写上大量重复的代码，管理极其不方便。为此 RMVL 参数模块定义了新的参数规范文件，这类文件以 <code>*.para</code> 为后缀，以及提供了 CMake 配置期间将 <code>*.para</code> 转换为对应 <code>*.h(hpp)</code> 以及 <code>*.cpp</code> 的 CMake 函数 <code>rmvl_generate_para</code>，该函数定义在 <code>&lt;project&gt;/cmake/RMVLGenPara.cmake</code> 文件中。</p>
<h2><a class="anchor" id="autotoc_md294"></a>
2. 参数规范文件</h2>
<p>这里举一个 <code>*.para</code> 文件的示例，写法与 ROS Message 的 <code>*.msg</code> 文件类似，不过参数的类型均使用 C/C++ 中的类型，并且添加了注释功能。</p>
<div class="fragment"><div class="line">#################### 光学参数 ####################</div>
<div class="line">float exposure = 1500  # 相机曝光</div>
<div class="line">float saturation = 100 # 相机饱和度</div>
<div class="line">float gain = 64        # 相机数字增益</div>
<div class="line">uint32_t b_gain = 1500 # 相机蓝色增益</div>
<div class="line">uint32_t g_gain = 1500 # 相机绿色增益</div>
<div class="line">uint32_t r_gain = 1500 # 相机红色增益</div>
<div class="line">int auto_exposure = 0  # 相机自动曝光模式</div>
<div class="line">int auto_wb = 0        # 相机自动白平衡模式</div>
<div class="line"> </div>
<div class="line">#################### 设备参数 ####################</div>
<div class="line">int grab_mode = 1     # 相机 grab 模式</div>
<div class="line">int retrieve_mode = 1 # 相机 retrieve 模式</div>
<div class="line">string serial_number  # 相机序列号</div>
</div><!-- fragment --><p>这里列出参数规范文件的参数类型表</p>
<div class="full_width_table"></div><div class="full_width_table"><center></center></div><div class="full_width_table"><center>表1：参数类型表</center></div><div class="full_width_table"><center></center></div><div class="full_width_table"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">数据类型   </th><th class="markdownTableHeadLeft">含义    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">基本类型   </td><td class="markdownTableBodyLeft">1. 包括 <code>int</code>、<code>uint8_t</code>、<code>double</code>、<code>float</code>、<code>string</code> 等<br  />
2. 对标 C++ 的基础类型和 <code>std::string</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">矩阵类型   </td><td class="markdownTableBodyLeft">1. 包括形如 <code>Matx??</code>、<code>Vec?</code> 的类型，例如 <code>Matx22f</code><br  />
2. 对标 OpenCV 的 <code>cv::Matx</code> 和 <code>cv::Vec</code><br  />
3. 可使用列表初始化和相关静态函数初始化，例如 <code>Matx22f::eye()</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">复合类型   </td><td class="markdownTableBodyLeft">1. 包括 <code>vector</code> 和形如 <code>Point?</code> 的类型<br  />
2. 对标 C++ 的 <code>std::vector</code> 以及 OpenCV 的<code>cv::Point2?</code> 和 <code>cv::Point3?</code><br  />
3. 只能使用列表初始化，例如 <code>{1, 2, 3}</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">枚举类型   </td><td class="markdownTableBodyLeft">1. 需要用户自定以 <code>enum</code> 开头和 <code>endenum</code> 结尾的数据类型声明<br  />
2. 对标 C++ 的有作用域枚举类型 <code>enum class</code><br  />
3. 变量的定义上与有作用域枚举类型一致，例如 <code>Color COLOR_MODE = Color::RED</code>   </td></tr>
</table>
</div><div class="full_width_table"></div><p>如果要给某一条参数设置默认值，需要使用 <code>=</code> 完成，不需要默认参数（仅由运行时加载设置）则不需要使用 <code>=</code> 进行赋值，例如</p>
<div class="fragment"><div class="line">int grab_mode = 1</div>
<div class="line">string serial_number</div>
</div><!-- fragment --><p>如果要给某一参数设置注释信息，请<span style="color: red">尾置</span> <code>#</code> 并输入相应注释信息，例如</p>
<div class="fragment"><div class="line">float exposure = 1500 # 相机曝光</div>
<div class="line">float gain = 64       # 相机数字增益</div>
</div><!-- fragment --><dl class="section note"><dt>注解</dt><dd><ul>
<li><code>#</code> 和注释信息之间<u><b>不必</b></u>使用空格分隔，例如 <code>#相机曝光</code></li>
</ul>
</dd></dl>
<p>枚举类型可在每个枚举项后加上具体的值，也能使用 <code>#</code> 为枚举项添加注释，例如</p>
<div class="fragment"><div class="line">enum ColorMode # 颜色类型</div>
<div class="line">  RED          # 红色</div>
<div class="line">  GREEN        # 绿色</div>
<div class="line">  BLUE = 4     # 蓝色</div>
<div class="line">  GRAY = 5</div>
<div class="line">endenum</div>
<div class="line"> </div>
<div class="line">ColorMode COLOR = ColorMode::RED # 颜色信息</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md295"></a>
3. C++ 代码生成</h2>
<p>从 <code>*.para</code> 到对应的 C++ 代码生成的过程依赖 RMVL 提供的两条 CMake 函数，分别是</p>
<ul>
<li><code>rmvl_generate_para</code></li>
<li><code>rmvl_generate_module_para</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md296"></a>
3.1 rmvl_generate_para</h3>
<p>根据指定的目标名在 param 文件夹下对应的 *.para 参数规范文件和可选的模块名生成对应的 C++ 代码。</p>
<p><b>用法</b></p>
<div class="fragment"><div class="line">rmvl_generate_para(</div>
<div class="line">  &lt;target_name&gt;</div>
<div class="line">  [MODULE module_name]</div>
<div class="line">)</div>
</div><!-- fragment --><p><b>示例</b></p>
<div class="fragment"><div class="line">rmvl_generate_para(</div>
<div class="line">  mytarget        # 目标名称</div>
<div class="line">  MODULE mymodule # 模块名称为 mymodule</div>
<div class="line">)</div>
</div><!-- fragment --><p>表示解析当前目录下的 <code>param/mytarget.para</code> 文件，并作为模块 <code>mymodule</code> 的子模块。最终生成的文件是</p>
<ul>
<li><code>include/rmvlpara/mymodule/mytarget.h</code>，<code>include/rmvlpara</code> 后文简记为 <code>&lt;prefix&gt;</code></li>
<li><code>src/para/mytarget.cpp</code></li>
</ul>
<p>这样的话会为参数模块汇总的头文件 <code>&lt;prefix&gt;/mymodule.hpp</code> 添加 <code>&lt;prefix&gt;/mymodule/mytarget.h</code> 文件的包含，即会在 <code>&lt;prefix&gt;/mymodule.hpp</code> 中添加</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;mymodule/mytarget.h&quot;</span></div>
</div><!-- fragment --><p>如果 <code>mytarget</code> 需要自成一个模块的话，那么在调用 <code>rmvl_generate_para</code> 函数的时候应该写为</p>
<div class="fragment"><div class="line">rmvl_generate_para(mytarget)</div>
</div><!-- fragment --><p>这样就会生成一个名为 <code>mytarget</code> 的参数模块了，最终生成的文件是</p>
<ul>
<li><code>include/rmvlpara/mytarget.hpp</code></li>
<li><code>src/para/mytarget.cpp</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md297"></a>
3.2 rmvl_generate_module_para</h3>
<p>根据给定模块下所有的 para 目标，生成对应的 C++ 代码</p>
<p><b>用法</b></p>
<div class="fragment"><div class="line">rmvl_generate_module_para(&lt;module_name&gt;)</div>
</div><!-- fragment --><p><b>示例</b></p>
<div class="fragment"><div class="line">rmvl_generate_module_para(mymodule)</div>
</div><!-- fragment --><p>表示将模块 <code>mymodule</code> 中的所有子模块打包至参数模块汇总头文件 <code>&lt;prefix&gt;/mymodule.hpp</code> ，例如，如果在 <code>CMakeLists.txt</code> 中写入</p>
<div class="fragment"><div class="line">rmvl_generate_para(a1 MODULE m)</div>
<div class="line">rmvl_generate_para(a2 MODULE m)</div>
<div class="line">rmvl_generate_para(a3 MODULE m)</div>
<div class="line"> </div>
<div class="line">rmvl_generate_module_para(m)</div>
</div><!-- fragment --><p>最后生成的 <code>&lt;prefix&gt;/m.hpp</code> 中就会包含</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;m/a1.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;m/a2.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;m/a3.h&quot;</span></div>
</div><!-- fragment --><p>以上内容均是在 CMake 配置期间自动完成，只需定义好参数规范文件 <code>*.para</code> 以及相应的 CMake 函数即可。</p>
<h2><a class="anchor" id="autotoc_md298"></a>
4. 运行时加载</h2>
<h3><a class="anchor" id="autotoc_md299"></a>
4.1 加载方式</h3>
<p>例如，对于以下的 <code>test.para</code> 文件</p>
<div class="fragment"><div class="line">int abc = 10 # 测试数</div>
</div><!-- fragment --><p>在使用 <code>rmvl_generate_para(test)</code> 之后，生成的头文件代码中，类相关的代码如下</p>
<div class="fragment"><div class="line">//! TestParam 参数模块</div>
<div class="line">struct TestParam</div>
<div class="line">{</div>
<div class="line">    //! 测试数 @note 默认值：`10`</div>
<div class="line">    int abc = 10;</div>
<div class="line"> </div>
<div class="line">    /**</div>
<div class="line">     * @brief 从指定 `YAML` 文件中加载 `TestParam`</div>
<div class="line">     *</div>
<div class="line">     * @note `YAML` 文件的后缀允许是 `*.yml` 和 `*.yaml`</div>
<div class="line">     * @param[in] path 参数路径</div>
<div class="line">     * @return 是否加载成功</div>
<div class="line">     */</div>
<div class="line">    bool load(const std::string &amp;path);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">//! TestParam 参数模块</div>
<div class="line">inline TestParam test_param;</div>
</div><!-- fragment --><p>其中包含了运行时参数导入和导出的接口 <code>read</code> 和 <code>write</code>，以 <a class="el" href="../../d9/d6f/group__para__algorithm.html">algorithm 的参数模块</a> 为例，<code><a class="el" href="../../d4/da1/classrm_1_1para_1_1AlgorithmParam.html#a5fa44d751710dbf5731635a5c9657c1c" title="从指定 YAML 文件中加载，并读取至 AlgorithmParam 中">rm::para::AlgorithmParam::read</a></code> 用于运行时读取 YAML 文件并配置 algorithm 模块的参数，<code><a class="el" href="../../d4/da1/classrm_1_1para_1_1AlgorithmParam.html#a07a26d44154b5864fea3eec801fd647d" title="将 AlgorithmParam 的数据写入指定的 YAML 文件中">rm::para::AlgorithmParam::write</a></code> 用于将当前 algorithm 模块的参数写入到 YAML 文件中。</p>
<p>用户可以通过使用类似以下的代码完成运行时加载</p>
<div class="fragment"><div class="line"><span class="comment">/* code */</span></div>
<div class="line"><a class="code hl_variable" href="../../d9/d6f/group__para__algorithm.html#ga53c0a2fe632cf1f3bb67aff47b8873b6">rm::para::algorithm_param</a>.read(prefix_path + <span class="stringliteral">&quot;algorithm.yml&quot;</span>);</div>
<div class="line"><span class="comment">/* code */</span></div>
<div class="ttc" id="agroup__para__algorithm_html_ga53c0a2fe632cf1f3bb67aff47b8873b6"><div class="ttname"><a href="../../d9/d6f/group__para__algorithm.html#ga53c0a2fe632cf1f3bb67aff47b8873b6">rm::para::algorithm_param</a></div><div class="ttdeci">AlgorithmParam algorithm_param</div><div class="ttdoc">AlgorithmParam 参数模块</div><div class="ttdef"><b>定义</b> algorithm.hpp:79</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md300"></a>
4.2 YAML 文件格式</h3>
<p>对于某个 <code>*.para</code> 文件中的参数，可以通过 YAML 文件进行运行时配置，例如</p>
<div class="fragment"><div class="line">int num = 10      # Test number</div>
<div class="line">float value = 4.2 # Test value</div>
<div class="line">string name       # Test name</div>
</div><!-- fragment --><p>对应的 YAML 文件可以写为</p>
<div class="fragment"><div class="line"># test.yml</div>
<div class="line">%YAML:1.0</div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">num: 20</div>
<div class="line">name: &quot;Hello, RMVL&quot;</div>
</div><!-- fragment --><p>在程序调用</p>
<div class="fragment"><div class="line">rm::para::test_param.read(prefix_path + <span class="stringliteral">&quot;test.yml&quot;</span>);</div>
</div><!-- fragment --><p>时，会实时加载该 YAML 文件，此时</p>
<ul>
<li><code>num</code> 的值会被设置为 <code>20</code></li>
<li><code>name</code> 的值会被设置为 <code>Hello, RMVL</code></li>
<li><code>value</code> 在 YAML 文件中为设置该值，因此 <code>value</code> 的值会保持不变，即为默认的 <code>4.2</code> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
制作者 &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../../doxygen.svg" alt="doxygen"/>
</a> 1.13.2
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
