<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta name="generator" content="Doxygen 1.15.0" />
  <title>RMVL: 引言与介绍</title>
  <link href="../../rmvl-logo-small.png" rel="shortcut icon" type="image/x-icon" />
  <link href="../../tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="../../jquery.js"></script>
  <script type="text/javascript" src="../../dynsections.js"></script>
  <script type="text/javascript" src="../../cookie.js"></script>
  <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
  <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
  <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
  <!-- ... other metadata & script includes ... -->
  <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
  </script>
  <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
  </script>
  <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeInteractiveToc.init()
  </script>
  <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeParagraphLink.init()
  </script>
  <script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeTabs.init()
  </script>
</head>
<body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
      <!--#include virtual="/google-search.html"-->
      <script type="text/javascript" src="/docs/version.js"></script>
      <table cellspacing="0" cellpadding="0">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectlogo"><img alt="Logo" src="../../rmvl-logo.png" /></td>
            <td style="padding-left: 0.5em;">
              <div id="projectname">RMVL
                &#160;<span id="projectnumber">2.4.0-dev</span>
              </div>
              <div id="projectbrief">Robotic Manipulation and Vision Library</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- end header part -->
<!-- 制作者 Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','搜索',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">引言与介绍 </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1 empty">
    <ul>
      <li class="level2">
        <a href="#autotoc_md2">写在前面 </a>
        <ul>
          <li class="level3">
            <a href="#YAT">前世今生 </a>
          </li>
          <li class="level3">
            <a href="#autotoc_md3">使用对象与基本情况 </a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#main_modules">主要模块 </a>
      </li>
      <li class="level2">
        <a href="#extra_modules">扩展模块 </a>
        <ul>
          <li class="level3">
            <a href="#data_components">数据组件 </a>
          </li>
          <li class="level3">
            <a href="#function_modules">功能模块 </a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#intro_design_principle">设计理念 </a>
        <ul>
          <li class="level3">
            <a href="#intro_uniform_interface">统一接口 </a>
          </li>
          <li class="level3">
            <a href="#intro_low_coupled_logic">低耦合逻辑 </a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#api_concepts">API 概念 </a>
        <ul>
          <li class="level3">
            <a href="#intro_namespace_rm">命名空间 rm </a>
          </li>
          <li class="level3">
            <a href="#intro_parameters_manager">参数管理 </a>
          </li>
          <li class="level3">
            <a href="#intro_error_handle">异常处理 </a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__2home_2zhaoxi_2_xE6_xA1_x8C_xE9_x9D_xA2_2Vision_2cv-rmvl_2rmvl_2doc_2intro"></a></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
写在前面</h2>
<h3 class="doxsection"><a class="anchor" id="YAT"></a>
前世今生</h3>
<p>RMVL 起源于 SRVL（SCUT Robotlab Vision Library——华南理工大学机器人实验室视觉库）。SRVL 由华南理工大学华南虎战队视觉组成员共同研发，于实验室团队内部自建的 Gitea 服务完成代码托管，组员在此之上进行功能开发和维护。SRVL 主要用于参加 <a href="https://www.robomaster.com">RoboMaster 系列赛事</a>。该项目在 RM2021 赛季内部技术交流活动后，即 2021 年 8 月正式启动，总共经过 3 届队员传承、更迭，依次开发了 1.x ~ 4.x 共 4 个系列的版本。</p>
<ul>
<li><b>1.x</b> —— <em>2021.10</em> 发布<span style="color: green">（未开源）</span>，主要针对 RoboMaster 2021 赛季步兵、英雄机器人代码混乱的情况进行设计，初步尝试了使用抽象工厂设计模式来设计代码架构，届时，SRVL 开发者和使用者的不同需求需要在 SRVL 编译过程中修改编译选项。</li>
<li><b>2.x</b> —— <em>2022.01</em> 发布<span style="color: green">（未开源）</span>，使用抽象工厂设计模式后出现了维护困难的情况，包括但不限于多个 <a class="el" href="#function_modules">功能模块</a> 共同组合，导致产生非常多的派生工厂，此版本针对这一弊端移除了原先所有的设计模式，各功能模块仅单独存在，不再另外设置组合或其他强依赖关系。此外， <b>2.x</b> 相较于 <b>1.x</b> 添加了全新的内容： <a class="el" href="../../dd/d46/group__group.html">序列组/相关追踪器的空间集合（数据组件）</a> 。</li>
<li><b>3.x</b> —— <em>2022.08</em> 发布<span style="color: green">（未开源）</span>，架构、功能进一步完善。在开发上，添加了 CI/CD 自动化构建测试工具，使用 GoogleTest 为已有的组件、模块添加了单元测试，使用 benchmark 为部分功能添加了性能基准测试；在功能上，移除原先所有的 <a class="el" href="../../dd/d46/group__group.html">序列组/相关追踪器的空间集合（数据组件）</a> ，重定义并完善了 <a class="el" href="../../dd/d46/group__group.html">序列组/相关追踪器的空间集合（数据组件）</a> 所应当具备的功能，后续在此系列代码基础上，完成了 <b>RM2023 版整车状态估计</b> ；在使用上，顶层模块与视觉库完全分离，涉及到各个功能开启或关闭的逻辑功能将设置在顶层模块，这一部分内容由用户自行实现。此外，该版本完善了 CMake 的项目构建方式，并且可通过 <span class="tt">make install/uninstall</span> 完成编译安装、卸载。</li>
<li><b>4.x</b> —— <em>2023.09</em> 发布<span style="color: green">（已开源）</span>，并登陆 <a href="https://github.com/cv-rmvl/rmvl">Github</a> 平台，更名 RMVL 以追求更加广泛的使用场景。并发布了 <b>RMVL 1.x</b> 系列版本，该系列彻底形成了面向对象迭代器设计模式与责任链设计模式相互结合的代码架构，同时将原先的 CI/CD 流水线迁移至 Github Actions。 <b>4.x</b> 版本在设计之初主要为了简化数据组件的开发，移除了不属于 <a class="el" href="#data_components">数据组件</a> 管理的，但在 <a class="el" href="#function_modules">功能模块</a> 中被设置的信息。此外还为各个 <a class="el" href="#function_modules">功能模块</a> 加入了 <span class="tt">XxxInfo</span> 的信息类。该版本首次加入命名空间 <span class="tt"><a class="el" href="../../d5/d20/namespacerm.html">rm</a></span>，避免了与其他库命名冲突的情况。此外，该版本极大程度简化并统一了参数模块的定义方式，将原先繁琐的参数定义、加载的功能使用自定义的参数文件 <span class="tt">*.para</span> 以及一组 CMake 函数 <span class="tt">rmvl_generate_para</span> 自动完成 C++ 代码生成与文档注解生成，为了更进一步简化参数模块的设计，RMVL 提供了 Visual Studio Code 的插件，为 <span class="tt">*.para</span> 文件提供语法高亮、代码提示、悬浮提示与代码块，并为 RMVL 中的部分函数与宏提供了代码提示、悬浮提示与代码块。</li>
<li><b>RMVL 2.x</b> —— <em>2024.09</em> 发布<span style="color: green">（已开源）</span>，在功能上，该系列首次加入了 Python 支持，可参考 <a class="el" href="../../d8/d88/tutorials_python.html">RMVL-Python 使用教程</a> ，此外还为 Windows 用户提供了 MSVC 编译器的支持，使用 CPack 工具，为 Windows 以及 Debian 系 Linux 发行版制作安装包。在架构上，新增 <a class="el" href="../../d5/d6c/group__algorithm.html">数学、算法模块</a> ，将原先 <a class="el" href="../../d0/de1/group__core.html">RMVL 核心模块</a> 中的各类算法迁移至该模块。新增 <a class="el" href="../../d2/da3/group__io.html">数据 IO 与通信模块</a> ，提供跨平台的 I/O 协程设施，以及同步、异步的串口通信、进程间通信等内容，并提供了异步的 HTTP Web 后端框架。</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
使用对象与基本情况</h3>
<p>RMVL 为硬件设备二次开发、网络通信、串口通信以及运动、控制、视觉算法提供了相应的支持库，为工业、日常环境下某些特征的识别、追踪等提供了完整的流程，同时也可为 RoboMaster 参赛者提供有关装甲板识别与运动追踪、能量机关识别与运动追踪等自动瞄准的完整内容，具体可提供的内容如下</p>
<ul>
<li>机器人在一些经典的、特有的工作环境下的功能需求，涉及到运动追踪、视觉识别等内容</li>
<li>控制、通信、数据结构的基础工具库</li>
<li>涉及 RM 的步兵机器人、英雄机器人、哨兵机器人和空中机器人 4 类射击型机器人的绝大部分功能</li>
<li>涉及 RM 其余兵种的部分识别算法功能</li>
</ul>
<p>该代码库易于维护，说明文档丰富且齐全， <a class="el" href="#extra_modules">扩展模块</a> 中所有的模块均已解耦，包括由特征 feature、特征组合 combo、追踪器 tracker 和序列组 group 组成的 <b>数据组件</b> ，由检测和识别模块 detector、补偿模块 compensator、目标预测模块 predictor 和 decider 组成的 <b>功能模块</b> ，这些模块分布在项目的 <span style="color: red">extra</span> 文件夹中。此外如上文所说，RMVL 还涉及到其余有关数据结构与算法、硬件设备二次开发库等内容，这些内容作为主要模块分布在项目的 <span style="color: red">modules</span> 文件夹中。</p>
<hr  />
<p>RMVL 具有模块化结构，这意味着该软件包包含了多个共享或静态库，有以下内容可用。</p>
<h2 class="doxsection"><a class="anchor" id="main_modules"></a>
主要模块</h2>
<ul>
<li><a class="el" href="../../d0/de1/group__core.html">RMVL 核心模块</a> (<b>core</b>) —— 包含主要的工具库、数据读写、宏定义、版本管理等内容，以及 <a class="el" href="../../d9/db4/classrm_1_1Exception.html" title="该类封装了有关程序中发生的错误的所有或几乎所有必要信息。异常通常是通过 RMVL_Error 和 RMVL_Error_ 宏隐式构造和抛出的">rm::Exception</a> 异常管理模块就在此处定义。</li>
<li><p class="startli"><a class="el" href="../../dc/d90/group__camera.html">相机模块</a> (<b>camera</b>) —— 目前包含 3 种相机厂商 SDK 的二次开发工具库，具体可参考下表。</p>
<div class="full_width_table"></div><div class="full_width_table"> 表 1: 相机厂商 SDK 二次开发工具库<br  />
 <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">厂商  </th><th class="markdownTableHeadCenter">简称  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">奥普特机器视觉  </td><td class="markdownTableBodyCenter">OPT  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">海康机器人 <em>HIKROBOT</em>  </td><td class="markdownTableBodyCenter">Hik  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">迈德威视 <em>Mindvision</em>  </td><td class="markdownTableBodyCenter">Mv  </td></tr>
</table>
</div><div class="full_width_table"> </div><p class="startli">点击<a class="el" href="../../d1/db4/tutorial_install.html">此处</a>可以安装以上相机的 SDK</p>
</li>
<li><a class="el" href="../../d2/da3/group__io.html">数据 IO 与通信模块</a> (<b>io</b>) —— 包含跨平台的 I/O 协程设施，以及同步、异步的串口通信、进程间通信等内容，并提供了异步的 HTTP Web 后端框架。</li>
<li><a class="el" href="../../dd/ded/group__ml.html">机器学习与深度学习支持库</a> (<b>ml</b>)， <a class="el" href="../../d3/da8/group__opcua.html">OPC UA 模块</a> (<b>opcua</b>)</li>
<li>... 以及其他包含在 <span class="tt">modules</span> 文件夹中的模块。</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="extra_modules"></a>
扩展模块</h2>
<h3 class="doxsection"><a class="anchor" id="data_components"></a>
数据组件</h3>
<p><a class="el" href="../../db/d72/group__feature.html">图像轮廓特征（数据组件）</a> (<b>feature</b>) —— RMVL 最基本的用于存储的数据结构，代表图像中的一个封闭曲线（轮廓、简单封闭图形）。开发中，轮廓通常可以使用 <b>OpenCV</b> <a class="el" href="../../d0/de3/citelist.html#CITEREF_opencv_library">[2]</a> 中的 <span class="tt">cv::findContours</span> 函数来获取，简单封闭图形可通过 <b>OpenCV</b> 中的 <span class="tt">imgproc</span> 模块提供的各类函数接口来进行获取，例如最小外接矩形 <span class="tt">cv::minAreaRect</span>、最小包络三角 <span class="tt">cv::minEnclosingTriangle</span> 等，提取到的对象 <span class="tt">cv::RotatedRect</span> 或一个 <span class="tt">cv::OutputArray</span> 等内容可由开发者自行转化成 feature 有用的信息（一般是通过 feature 的构造函数完成）。此外 RMVL 提供了默认 feature，即 <a class="el" href="../../de/de0/classrm_1_1DefaultFeature.html" title="默认图像特征，仅表示一个孤立的点 cv::Point2f">rm::DefaultFeature</a> ，用于表示无轮廓的信息，一般是一个角点。</p>
<p><a class="el" href="../../dd/dd2/group__combo.html">特征组合体（数据组件）</a> (<b>combo</b>) —— 这种类型的组件由一系列特征组成，并使用 <span class="tt">std::vector&lt;feature::ptr&gt;</span> 来存储它们，特征的数量通常不会太多，并且这类特征在物理空间中通常是刚性的，即特征之间大致具备尺度不变的特点。开发中，一般会使用若干特征以及附带信息用于构造 combo 的派生对象。此外 RMVL 提供了默认 combo，即 <a class="el" href="../../d1/daf/classrm_1_1DefaultCombo.html" title="默认组合体，包含一个固定的特征，退化为 feature 使用">rm::DefaultCombo</a> ，用于表示单独的无关联的 feature。</p>
<p><a class="el" href="../../de/dca/group__tracker.html">追踪器/特征组合的时间序列（数据组件）</a> (<b>tracker</b>) —— tracker 是在时间上包含了许多相同物理特性的 combo，从而形成一个 combo 的时间序列，在 RMVL 中，则通过使用 <span class="tt">std::deque&lt;combo::ptr&gt;</span> 来表示这个时间序列。在功能上，tracker 不仅表示了不同时间下相同的 combo 的相关信息，还能处理在某个时间点上获取到不正确的 combo 的异常情况。此外 RMVL 提供了默认 tracker，即 <a class="el" href="../../d3/d25/classrm_1_1DefaultTracker.html" title="默认追踪器，时间序列仅用于存储组合体，可退化为 combos 使用">rm::DefaultTracker</a> ，用于表示无需时间序列信息的一组 combo。</p>
<p><a class="el" href="../../dd/d46/group__group.html">序列组/相关追踪器的空间集合（数据组件）</a> (<b>group</b>) —— 如果多个追踪器在物理空间上具有一定的相关性，比如共享轴旋转、刚性连接等属性，它们可以一起形成一个序列组 group，从而能够表示更加高级的物理信息。序列组使用 <span class="tt">std::vector&lt;tracker::ptr&gt;</span> 来存储这些追踪器。此外 RMVL 提供了默认 group，即 <a class="el" href="../../d0/df4/classrm_1_1DefaultGroup.html" title="默认序列组（一般退化为 trackers 使用）">rm::DefaultGroup</a> ，用于表示若干无相关性的一组 tracker，即退化成了 <span class="tt">std::vector&lt;tracker::ptr&gt;</span>。</p>
<h3 class="doxsection"><a class="anchor" id="function_modules"></a>
功能模块</h3>
<p><a class="el" href="../../da/d8e/group__detector.html">检测与识别模块（功能模块）</a> (<b>detector</b>) —— 识别、检测器是功能模块中最重要的部分，也是视觉图像处理的第一步。它负责对输入图像进行识别并加以处理，提取出目标轮廓、特征点等信息，并结合已知的部分数据组件，按顺序依次构建各种新的数据组件。识别得到的各种图像以及提取到的特征和组合体均保存至识别模块信息 <span class="tt"><a class="el" href="../../df/dae/structrm_1_1DetectInfo.html" title="识别信息结构体">rm::DetectInfo</a></span> 中。</p>
<div class="image">
<img src="../../detector.jpg" alt=""/>
<div class="caption">
图 1 装甲识别模块</div></div>
    <p><a class="el" href="../../d7/d4f/group__compensator.html">补偿模块（功能模块）</a> (<b>compensator</b>) —— 补偿器通常是功能模块中的第一个用于修正数据组件的算法模块，<span style="color: green">主要在 RoboMaster 赛事中使用</span>。补偿器主要负责修正弹道下坠的影响。计算得到的子弹飞行时间 <span class="tt">tof</span> 以及补偿增量 <span class="tt">compensation</span> 均保存至补偿模块信息 <span class="tt"><a class="el" href="../../d5/da4/structrm_1_1CompensateInfo.html" title="补偿模块信息">rm::CompensateInfo</a></span> 中。</p>
<p><a class="el" href="../../db/d29/group__predictor.html">目标预测模块（功能模块）</a> (<b>predictor</b>) —— 对于需要考虑目标追踪或存在较长通讯延迟的机器人而言，必须要引入目标预测环节，使得伺服机构能够恒定追踪、捕获目标，<span style="color: green">在 RoboMaster 赛事中一般用于保证弹丸能够准确击中敌方目标</span>。一般而言，每一个预测模块会针对特定的数据组件（派生的 group 对象）进行 2~3 种预测量类型的计算，包括动态响应预测量 <span class="tt">Kt</span>、静态响应预测量 <span class="tt">B</span>、射击延迟预测量 <span class="tt">Bs</span>，每种预测量类型都包含 9 种预测对象，每个预测对象之间对于 3 种预测量类型来说都是线性关系，例如在 <a class="el" href="../../db/d1b/group__gyro__predictor.html">整车状态预测模块</a> 中对于 <span class="tt">ANG_Y</span> 预测对象的 3 种预测量都是单独计算的，这也便于后续的 <b>决策模块</b> 能够自由组合这些预测量。同样，计算得到的各类预测量均被保存至预测模块信息 <span class="tt"><a class="el" href="../../d7/d51/structrm_1_1PredictInfo.html" title="预测模块信息">rm::PredictInfo</a></span> 中。</p>
<center></center><center><div class="image">
<img src="../../predictor.png" alt=""/>
<div class="caption">
图 2 能量机关预测模块</div></div>
    </center><center></center><p><a class="el" href="../../d9/dbe/group__decider.html">决策模块（功能模块）</a> (<b>decider</b>) —— 在经过识别、补偿和预测 3 个步骤后，需要使用特定的策略来获得当前时刻的最优目标，结合前三个步骤的信息（包含识别模块信息 <span class="tt">DetectInfo</span> 、补偿模块信息 <span class="tt">CompensateInfo</span> 、预测模块信息 <span class="tt">PredictInfo</span> ）导出到决策模块信息 <span class="tt"><a class="el" href="../../d9/da7/structrm_1_1DecideInfo.html" title="决策模块信息">rm::DecideInfo</a></span> 中。</p>
<div class="image">
<img src="../../decider.jpg" alt=""/>
<div class="caption">
图 3 整车状态决策模块</div></div>
    <p>该文档的后续章节描述了每个模块的功能。但首先，请确保了解 RMVL 的设计理念以及 API 概念。</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="intro_design_principle"></a>
设计理念</h2>
<h3 class="doxsection"><a class="anchor" id="intro_uniform_interface"></a>
统一接口</h3>
<p>RMVL 中 <b>extra</b> 模块的每个功能都设计有一个抽象类和一系列派生类，以严格限制暴露的接口并实现接口的统一性。这种方法有助于顶层项目统一管理功能模块中特定的方法，顶层项目开发人员可以专注于模块之间的逻辑关系处理。例如，您可以使用同一接口实现不同的功能。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;rmvl/detector.hpp&gt;</span></div>
<div class="line"><span class="comment">/* ... */</span></div>
<div class="line">std::vector&lt;rm::detector::ptr&gt; detectors;</div>
<div class="line">detectors.emplace_back(<a class="code hl_function" href="../../dc/d93/classrm_1_1GyroDetector.html#a4847eef03a2bad126fedfaad567f180e">rm::GyroDetector::make_detector</a>(4));</div>
<div class="line">detectors.emplace_back(<a class="code hl_function" href="../../d8/d35/classrm_1_1TagDetector.html#a61d242bc1cec93b2ab54a64afb52ffca">rm::TagDetector::make_detector</a>());</div>
<div class="line">detectors.emplace_back(<a class="code hl_function" href="../../d6/deb/classrm_1_1RuneDetector.html#a158fb7e5978ef93fb86741dec2fad8ff">rm::RuneDetector::make_detector</a>());</div>
<div class="line"> </div>
<div class="line">std::vector&lt;rm::group::ptr&gt; groups;</div>
<div class="line"><span class="comment">/* ... */</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;p_detector : detectors) {</div>
<div class="line">    <span class="keyword">auto</span> info = p_detector-&gt;detect(groups, src, color, imu_data, tick);</div>
<div class="line">    <span class="comment">/* ... */</span></div>
<div class="line">}</div>
<div class="line"><span class="comment">/* ... */</span></div>
<div class="ttc" id="aclassrm_1_1GyroDetector_html_a4847eef03a2bad126fedfaad567f180e"><div class="ttname"><a href="../../dc/d93/classrm_1_1GyroDetector.html#a4847eef03a2bad126fedfaad567f180e">rm::GyroDetector::make_detector</a></div><div class="ttdeci">static ptr make_detector(int armor_num=0)</div><div class="ttdoc">构建 GyroDetector</div><div class="ttdef"><b>定义</b> gyro_detector.h:60</div></div>
<div class="ttc" id="aclassrm_1_1RuneDetector_html_a158fb7e5978ef93fb86741dec2fad8ff"><div class="ttname"><a href="../../d6/deb/classrm_1_1RuneDetector.html#a158fb7e5978ef93fb86741dec2fad8ff">rm::RuneDetector::make_detector</a></div><div class="ttdeci">static ptr make_detector()</div><div class="ttdoc">构建 RuneDetector</div><div class="ttdef"><b>定义</b> rune_detector.h:43</div></div>
<div class="ttc" id="aclassrm_1_1TagDetector_html_a61d242bc1cec93b2ab54a64afb52ffca"><div class="ttname"><a href="../../d8/d35/classrm_1_1TagDetector.html#a61d242bc1cec93b2ab54a64afb52ffca">rm::TagDetector::make_detector</a></div><div class="ttdeci">static ptr make_detector()</div><div class="ttdoc">构造 TagDetector</div><div class="ttdef"><b>定义</b> tag_detector.h:59</div></div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="intro_low_coupled_logic"></a>
低耦合逻辑</h3>
<p>RMVL 的 <b>extra</b> 模块中的各个功能模块之间的耦合度非常低，它们在代码上不会设置强依赖关系。例如，自动瞄准的功能可以通过以下代码实现，它们之间共享的数据组件是一个序列组列表：<span class="tt">groups</span>。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;rmvl/detector.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;rmvl/compensator.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;rmvl/predictor.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;rmvl/decider.hpp&gt;</span></div>
<div class="line"><span class="comment">/* ... */</span></div>
<div class="line"><a class="code hl_typedef" href="../../d3/d77/classrm_1_1detector.html#a0eaa4d8bcf44807e09e96ae2b9bbfd42">rm::detector::ptr</a> p_detector = <a class="code hl_function" href="../../db/d6e/classrm_1_1ArmorDetector.html#a7cb826c0d675b35606d3efef46a9b587">rm::ArmorDetector::make_detector</a>();</div>
<div class="line"><a class="code hl_typedef" href="../../df/d72/classrm_1_1compensator.html#a83b85a64e4716ba1146cce81c7399c1a">rm::compensator::ptr</a> p_compensator = <a class="code hl_function" href="../../d3/d7a/classrm_1_1GravityCompensator.html#af52c5d0ccff5ee75f15cb246f56f0ef6">rm::GravityCompensator::make_compensator</a>();</div>
<div class="line"><a class="code hl_typedef" href="../../dc/d74/classrm_1_1predictor.html#a9bea1d235d789bfaf9e68f53ea847d6a">rm::predictor::ptr</a> p_predictor = <a class="code hl_function" href="../../d6/df1/classrm_1_1ArmorPredictor.html#a60e21d14289fabf9990e92abb1f48aa8">rm::ArmorPredictor::make_predictor</a>();</div>
<div class="line"><a class="code hl_typedef" href="../../d9/d29/classrm_1_1decider.html#a8655c1d33d48671c5ecb63e0c415542e">rm::decider::ptr</a> p_decider = <a class="code hl_function" href="../../de/dfc/classrm_1_1TranslationDecider.html#a50e3961a37db63c1e0c330daa6cdfdd5">rm::TranslationDecider::make_decider</a>();</div>
<div class="line">std::vector&lt;rm::group::ptr&gt; groups;</div>
<div class="line"><span class="comment">/* ... */</span></div>
<div class="line"><span class="keyword">auto</span> detect_info = p_detector-&gt;detect(groups, src, BLUE, <a class="code hl_struct" href="../../db/def/structrm_1_1ImuData.html">rm::ImuData</a>(), Timer::now());</div>
<div class="line"><span class="keyword">auto</span> compensate_info = p_compensator-&gt;compensate(groups, {imu_data.yaw, imu_data.pitch}, shoot_speed);</div>
<div class="line"><span class="keyword">auto</span> predict_info = p_predictor-&gt;predict(groups);</div>
<div class="line"><span class="keyword">auto</span> decide_info = p_decider-&gt;decide(groups);</div>
<div class="line"><span class="comment">/* ... */</span></div>
<div class="ttc" id="aclassrm_1_1ArmorDetector_html_a7cb826c0d675b35606d3efef46a9b587"><div class="ttname"><a href="../../db/d6e/classrm_1_1ArmorDetector.html#a7cb826c0d675b35606d3efef46a9b587">rm::ArmorDetector::make_detector</a></div><div class="ttdeci">static auto make_detector()</div><div class="ttdoc">构建 ArmorDetector</div><div class="ttdef"><b>定义</b> armor_detector.h:53</div></div>
<div class="ttc" id="aclassrm_1_1ArmorPredictor_html_a60e21d14289fabf9990e92abb1f48aa8"><div class="ttname"><a href="../../d6/df1/classrm_1_1ArmorPredictor.html#a60e21d14289fabf9990e92abb1f48aa8">rm::ArmorPredictor::make_predictor</a></div><div class="ttdeci">static std::unique_ptr&lt; ArmorPredictor &gt; make_predictor()</div><div class="ttdoc">构建 ArmorPredictor</div><div class="ttdef"><b>定义</b> armor_predictor.h:27</div></div>
<div class="ttc" id="aclassrm_1_1GravityCompensator_html_af52c5d0ccff5ee75f15cb246f56f0ef6"><div class="ttname"><a href="../../d3/d7a/classrm_1_1GravityCompensator.html#af52c5d0ccff5ee75f15cb246f56f0ef6">rm::GravityCompensator::make_compensator</a></div><div class="ttdeci">static auto make_compensator()</div><div class="ttdoc">构造 GravityCompensator</div><div class="ttdef"><b>定义</b> gravity_compensator.h:30</div></div>
<div class="ttc" id="aclassrm_1_1TranslationDecider_html_a50e3961a37db63c1e0c330daa6cdfdd5"><div class="ttname"><a href="../../de/dfc/classrm_1_1TranslationDecider.html#a50e3961a37db63c1e0c330daa6cdfdd5">rm::TranslationDecider::make_decider</a></div><div class="ttdeci">static std::unique_ptr&lt; TranslationDecider &gt; make_decider()</div><div class="ttdoc">构造 TranslationDecider</div><div class="ttdef"><b>定义</b> translation_decider.h:29</div></div>
<div class="ttc" id="aclassrm_1_1compensator_html_a83b85a64e4716ba1146cce81c7399c1a"><div class="ttname"><a href="../../df/d72/classrm_1_1compensator.html#a83b85a64e4716ba1146cce81c7399c1a">rm::compensator::ptr</a></div><div class="ttdeci">std::unique_ptr&lt; compensator &gt; ptr</div><div class="ttdef"><b>定义</b> compensator.h:59</div></div>
<div class="ttc" id="aclassrm_1_1decider_html_a8655c1d33d48671c5ecb63e0c415542e"><div class="ttname"><a href="../../d9/d29/classrm_1_1decider.html#a8655c1d33d48671c5ecb63e0c415542e">rm::decider::ptr</a></div><div class="ttdeci">std::unique_ptr&lt; decider &gt; ptr</div><div class="ttdef"><b>定义</b> decider.h:43</div></div>
<div class="ttc" id="aclassrm_1_1detector_html_a0eaa4d8bcf44807e09e96ae2b9bbfd42"><div class="ttname"><a href="../../d3/d77/classrm_1_1detector.html#a0eaa4d8bcf44807e09e96ae2b9bbfd42">rm::detector::ptr</a></div><div class="ttdeci">std::unique_ptr&lt; detector &gt; ptr</div><div class="ttdef"><b>定义</b> detector.h:51</div></div>
<div class="ttc" id="aclassrm_1_1predictor_html_a9bea1d235d789bfaf9e68f53ea847d6a"><div class="ttname"><a href="../../dc/d74/classrm_1_1predictor.html#a9bea1d235d789bfaf9e68f53ea847d6a">rm::predictor::ptr</a></div><div class="ttdeci">std::unique_ptr&lt; predictor &gt; ptr</div><div class="ttdef"><b>定义</b> predictor.h:60</div></div>
<div class="ttc" id="astructrm_1_1ImuData_html"><div class="ttname"><a href="../../db/def/structrm_1_1ImuData.html">rm::ImuData</a></div><div class="ttdoc">IMU 数据</div><div class="ttdef"><b>定义</b> util.hpp:49</div></div>
</div><!-- fragment --><p>例如，对一个数据组件进行识别的结果并不影响预测的逻辑。换句话说，如果要开发一个 RMVL 视觉功能，在对象识别过程中，异常和不合格的对象不应该被交给预测、补偿和决策模块进行后续处理，而应由识别检测模块本身解决。</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="api_concepts"></a>
API 概念</h2>
<h3 class="doxsection"><a class="anchor" id="intro_namespace_rm"></a>
命名空间 rm</h3>
<p>在 RMVL 中所有的类和函数都放置在 <span class="tt"><a class="el" href="../../d5/d20/namespacerm.html">rm</a></span> 命名空间中。因此，在您的代码中访问这些功能时，请使用 <span class="tt"><a class="el" href="../../d5/d20/namespacerm.html">rm</a>::</span> 限定符或 <span class="tt">using namespace <a class="el" href="../../d5/d20/namespacerm.html">rm</a>;</span> 的指令</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;rmvl/camera.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="../../de/de8/classrm_1_1MvCamera.html">rm::MvCamera</a> mv(<a class="code hl_struct" href="../../df/dfa/structrm_1_1CameraConfig.html">rm::CameraConfig</a>{});</div>
<div class="ttc" id="aclassrm_1_1MvCamera_html"><div class="ttname"><a href="../../de/de8/classrm_1_1MvCamera.html">rm::MvCamera</a></div><div class="ttdoc">迈德威视相机库</div><div class="ttdef"><b>定义</b> mv_camera.h:37</div></div>
<div class="ttc" id="astructrm_1_1CameraConfig_html"><div class="ttname"><a href="../../df/dfa/structrm_1_1CameraConfig.html">rm::CameraConfig</a></div><div class="ttdoc">相机初始化配置模式</div><div class="ttdef"><b>定义</b> camutils.hpp:54</div></div>
</div><!-- fragment --><p>或使用</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;rmvl/camera.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d5/d20/namespacerm.html">rm</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="../../de/de8/classrm_1_1MvCamera.html">MvCamera</a> mv(<a class="code hl_struct" href="../../df/dfa/structrm_1_1CameraConfig.html">CameraConfig</a>{});</div>
<div class="ttc" id="anamespacerm_html"><div class="ttname"><a href="../../d5/d20/namespacerm.html">rm</a></div><div class="ttdef"><b>定义</b> datastruct.hpp:24</div></div>
</div><!-- fragment --><p>第二种方式引入了整个命名空间，容易造成访问冲突，在不影响可读性的情况下建议使用第一种方案。RMVL 中的嵌套命名空间较少，并且一般很少直接使用，不会对可读性造成很大的影响。</p>
<h3 class="doxsection"><a class="anchor" id="intro_parameters_manager"></a>
参数管理</h3>
<p>不同的机器人具有不同的属性，它们对功能需求、运动响应和通信延迟都有不同的影响。RMVL 为所有这些参数提供了默认值，以确保正确的运行。但在实际部署时，但这些参数通常不是最有效的、最正确的，因此像机器人这样的顶层项目需要手动加载这些参数以最大化性能。</p>
<p><b>定义</b></p>
<p>参数规范文件本身由 <span class="tt">*.para</span> 文件所规定，包含了该参数的类型、标识符、默认值以及注释。这个文件在 CMake 运行期间会生成一系列对应的 <span class="tt">*.cpp</span> 和 <span class="tt">*.h (*.hpp)</span>，这个功能由一系列 <b>CMake</b> 语法定义，例如 <span class="tt">rmvl_generate_para</span>。</p>
<p><b>加载</b></p>
<p>RMVL 的所有参数文件都是通过 <b>YAML</b> 文件的读取和写入完成运行时的参数加载的，每个参数类中均提供了一致的接口 <span class="tt">read()</span> 和 <span class="tt">write()</span> 用于从 YAML 文件中读取、写入参数，可参考以下代码：</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;rmvlpara/combo/armor.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;rmvlpara/camera/camera.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* code */</span></div>
<div class="line"> </div>
<div class="line">std::string prefix_str = <span class="stringliteral">&quot;../etc/&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (!<a class="code hl_variable" href="../../d4/d8a/group__para__combo.html#ga82ec73a503c266c1d909e8b133490785">rm::para::armor_param</a>.read(prefix_str + <span class="stringliteral">&quot;armor_param.yml&quot;</span>))</div>
<div class="line">    printf(<span class="stringliteral">&quot;Failed to load the param: \&quot;armor_param\&quot;.&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!<a class="code hl_variable" href="../../d2/df4/group__para__camera.html#ga920ea1f18537e54423f9f6c0ff586b55">rm::para::camera_param</a>.read(prefix_str + <span class="stringliteral">&quot;camera_param.yml&quot;</span>))</div>
<div class="line">    printf(<span class="stringliteral">&quot;Failed to load the param: \&quot;camera_param\&quot;.&quot;</span>);</div>
<div class="ttc" id="agroup__para__camera_html_ga920ea1f18537e54423f9f6c0ff586b55"><div class="ttname"><a href="../../d2/df4/group__para__camera.html#ga920ea1f18537e54423f9f6c0ff586b55">rm::para::camera_param</a></div><div class="ttdeci">CameraParam camera_param</div><div class="ttdoc">CameraParam 参数模块</div><div class="ttdef"><b>定义</b> camera.h:71</div></div>
<div class="ttc" id="agroup__para__combo_html_ga82ec73a503c266c1d909e8b133490785"><div class="ttname"><a href="../../d4/d8a/group__para__combo.html#ga82ec73a503c266c1d909e8b133490785">rm::para::armor_param</a></div><div class="ttdeci">ArmorParam armor_param</div><div class="ttdoc">ArmorParam 参数模块</div><div class="ttdef"><b>定义</b> armor.h:101</div></div>
</div><!-- fragment --><p>这段代码中，<span class="tt">armor</span> 和 <span class="tt"><a class="el" href="../../dc/d90/group__camera.html">相机模块</a></span> 参数类的头文件被包含，并使用成员方法 <span class="tt">read()</span> 来加载参数。</p>
<h3 class="doxsection"><a class="anchor" id="intro_error_handle"></a>
异常处理</h3>
<p>RMVL 使用异常 (exception) 来触发错误，当输入数据出现格式错误、范围错误、内存错误等异常情况，它会返回一个特殊的错误代码。</p>
<p>异常可以是 <a class="el" href="../../d9/db4/classrm_1_1Exception.html" title="该类封装了有关程序中发生的错误的所有或几乎所有必要信息。异常通常是通过 RMVL_Error 和 RMVL_Error_ 宏隐式构造和抛出的">rm::Exception</a> 的实例化对象，或者其派生对象。此外 <a class="el" href="../../d9/db4/classrm_1_1Exception.html" title="该类封装了有关程序中发生的错误的所有或几乎所有必要信息。异常通常是通过 RMVL_Error 和 RMVL_Error_ 宏隐式构造和抛出的">rm::Exception</a> 是 <span class="tt">std::exception</span> 的派生类，因此可以优雅的使用标准 C++ 库的各类组件来处理 RMVL 抛出的异常。</p>
<p>RMVL 中的异常通常是使用 <span class="tt"><a class="el" href="../../d0/de1/group__core.html#gaf280cef1ac39cc635210419c6aa9e8dd" title="调用错误处理程序">RMVL_Error(code, msg)</a></span> 宏或类似 <span class="tt">printf</span> 的 <span class="tt"><a class="el" href="../../d0/de1/group__core.html#ga6ceb64e0c1708b39fed13fc311c3cdfc" title="调用错误处理程序">RMVL_Error_(code, fmt, args...)</a></span> 变体进行触发的，或者可以使用 <span class="tt"><a class="el" href="../../d0/de1/group__core.html#gac56d8385bc039215b7c14f05210dab1c" title="在运行时检查条件，如果失败则抛出异常">RMVL_Assert(cond)</a></span> 宏检查条件并在不满足条件时触发异常。对于性能要求高的代码，有一个 <span class="tt"><a class="el" href="../../d0/de1/group__core.html#gaaa1505e84ee5a1d4ce66ca3a959786a7" title="在 Debug 条件下或启用静态分析工具的情况下，在运行时检查条件，如果失败则抛出异常">RMVL_DbgAssert(cond)</a></span> ，它只保留在 Debug 配置中。由于自动内存管理，所有中间缓冲区自动释放的情况下突然出现错误，您只需添加 <span class="tt">try</span> 语句来捕获异常。</p>
<div class="fragment"><div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    ... <span class="comment">// 调用 RMVL 函数</span></div>
<div class="line">} <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code hl_class" href="../../d9/db4/classrm_1_1Exception.html">rm::Exception</a>&amp; <a class="code hl_variable" href="../../d5/d6c/group__algorithm.html#ga8f0640abdfeaeac18c46eac605f7f0a5">e</a>) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* err_msg = <a class="code hl_variable" href="../../d5/d6c/group__algorithm.html#ga8f0640abdfeaeac18c46eac605f7f0a5">e</a>.what();</div>
<div class="line">    printf(<span class="stringliteral">&quot;exception caught: %s&quot;</span>, err_msg);</div>
<div class="line">}</div>
<div class="ttc" id="aclassrm_1_1Exception_html"><div class="ttname"><a href="../../d9/db4/classrm_1_1Exception.html">rm::Exception</a></div><div class="ttdoc">该类封装了有关程序中发生的错误的所有或几乎所有必要信息。异常通常是通过 RMVL_Error 和 RMVL_Error_ 宏隐式构造和抛出的</div><div class="ttdef"><b>定义</b> util.hpp:129</div></div>
<div class="ttc" id="agroup__algorithm_html_ga8f0640abdfeaeac18c46eac605f7f0a5"><div class="ttname"><a href="../../d5/d6c/group__algorithm.html#ga8f0640abdfeaeac18c46eac605f7f0a5">rm::e</a></div><div class="ttdeci">constexpr double e</div><div class="ttdoc">自然对数底数:</div><div class="ttdef"><b>定义</b> math.hpp:38</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
制作者 &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../../doxygen.svg" alt="doxygen"/>
</a> 1.15.0
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
